<!DOCTYPE html>
<html>
	<head>
		<title> Putt Party </title>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<meta charset="UTF-8">
		<style>
			@font-face {
				font-family: "varela";
				font-display: swap;
				src: url("./putt/assets/varela.woff2") format("woff2");
			}
			* {
				font-family: "varela";
			}
			body {
				color: white;
				padding: 0;
				margin: 0;
				font-size: 120%;
				overflow: hidden;
				background: #222;
			}
			button {
				cursor: pointer;
			}
			#menu {
				text-align: center;
				background: #222;
				height: 100vh;
				width: 400vw;
				position: absolute;
				top: 0;
				left: 0;
				transition: 0.5s transform ease;
			}
				h1 {
					position: fixed;
					width: 100vw;
					line-height: 10vh;
					padding: 0;
					margin: 0;
				}
				#menuitem {
					height: 100vh;
					transition: 0.5s transform ease;
				}
				#menuitem > * {
					width: calc(100vw - 10vmin);
					height: calc(100% - 10vmin);
					padding: 5vmin;
					float: left;
					position: relative;
				}
				.menushortcut {
					font-size: 5vmin;
					color: white;
					width: 10vmin !important;
					height: 10vmin;
					padding: 1vmin !important;;
					margin: 1vmin !important;
					border: none;
					background: none;
					position: absolute;
					bottom: 0;
					transition: 0.5s transform ease;
					user-select: none;
				}
				.menushortcut > a {
					text-decoration: none;
					pointer-events: none;
				}
				.menushortcut.active > a {
					pointer-events: all !important;
				}
				.menushortcut:hover {
					transform: rotate(20deg) scale(1.1);
				}
					.menushortcut.left   { left:  0 }
					.menushortcut.right  { right: 0 }
				#menugrid {
					display: grid;
					grid-template-columns: 1fr 1fr;
					grid-gap: 1vmin;
					height: 100%;
					padding: 2vmin;
					overflow-y: scroll;
				}
				#menugrid > * {
					border: none;
					border-radius: 1vmin;
				}
				#menugrid > div {
					text-align: left;
				}
				#menugrid > input {
					text-align: right;
					height: 4vmin;
					padding: 2vmin;
				}
				#menugrid > h6, #menusettingsreset {
					grid-area: 1 span / 2 span;
					margin: 0;
					margin-top: 1vmin;
					padding: 0;
					font-weight: normal;
					font-size: 120%;
				}
				#menusettingsreset {
					padding: 2vmin;
					width: min-content;
					padding-left: 8vmin;
					padding-right: 8vmin;
					margin: auto;
				}
				#menucreditscontainer {
					width: min-content;
					margin: auto;
				}
				#menucreditscontainer > a {
					text-align: left;
					display: block;
					color: white;
					text-decoration: none;
					white-space: nowrap;
					margin-bottom: 48px;
				}
				#menucreditscontainer .text {
					display: inline;
					padding-left: 32px;
					line-height: 64px;
				}
				#menucreditscontainer .icon {
					float: left;
				}
				#menumain > * {
					text-align: center;
					border: none;
					border-radius: 1vmin;
					padding: 2vmin;
					margin: 2vmin;
					width: 50vw;
				}
				#menueditor > iframe {
					width: 100vw;
					height: 100vh;
					position: absolute;
					top: 0;
					left: 0;
					border: none;
				}
				#game {
					border: none;
					position: absolute;
					height: 100vh;
					width: 100vw;
					top: 0;
					left: 0;
				}
		</style>
	</head>
	<body>
		<iframe id="game"> </iframe>
		<div id="menu">
			 <h1> Putt Party </h1>
			 <div id="menuitem" style="transform:translateX(-200vw)">
				<div id="menucredits">
					<h2> Credits</h2>
					<h6> Wow I got clicked<br>Thanks to these people for stuff </h6>
					<div id="menucreditscontainer">
						<a href="https://github.com/SollyBunny/putt" target="_blank">
							<svg width="64" height="64" class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 20 20" version="1.1">
								<circle fill="white" cx="10" cy="10" r="10"/>
								<g transform="translate(2, 2)">
									<path fill="black" d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/>
								</g>
							</svg>
							<div class="text"> Source on GitHub! (SollyBunny) </div>
						</a>
						<a href="https://fonts.google.com/specimen/Varela+Round" target="_blank">
							<image width="64" height="64" class="icon" style="border-radius:100%" src="putt/assets/font/joeprince.jpg"></image>
							<div class="text"> The font Varella (Joe Prince) </div>
						</a>
						<a href="https://threejs.org/">
							<svg width="64" height="64" class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 226.77 226.77">
								<circle fill="white" cx="113.385" cy="113.385" r="113.385"/>
								<g fill="transparent" transform="translate(20 5)" stroke="#000" stroke-linecap="butt" stroke-linejoin="round" stroke-width="4">
									<path d="m63.02 200.61-43.213-174.94 173.23 49.874z"/>
									<path d="m106.39 50.612 21.591 87.496-86.567-24.945z"/>
									<path d="m84.91 125.03-10.724-43.465 43.008 12.346z"/>
									<path d="m63.458 38.153 10.724 43.465-43.008-12.346z"/>
									<path d="m149.47 62.93 10.724 43.465-43.008-12.346z"/>
									<path d="m84.915 125.06 10.724 43.465-43.008-12.346z"/>
								</g>
							</svg>
							<div class="text"> Three.JS used for 3D rendering </div>
						</a>
						<a href="https://pmndrs.github.io/cannon-es/">
							<image width="64" height="64" class="icon" style="border-radius:100%" src="putt/assets/stefanhedman.png"></image>
							<div class="text"> Cannon.ES (contuation of Cannon.JS) used for physics </div>
						</a>
					</div>
					<h6> And of course, <bold>you</bold>, the player </h6>
					<button class="menushortcut right" onclick="page(-1)"> <a disabled href=" " title="Back"> ‚û°Ô∏è </a> </button>
				</div>
			 	<div id="menusettings">
					<div id="menugrid">
						<h6> General </h6>
						<div> Name </div> <input attr="0" oninput="settingsset()" type="text" placeholder="Noob1234">
						<div> Color </div> <input attr="1" oninput="settingsset()" type="text" placeholder="FF0000">
						<h6> Gameplay </h6>
						<div> Sensitivity </div> <input attr="2" oninput="settingsset()" type="number">
						<div> Arrow Distance </div> <input attr="3" oninput="settingsset()" type="number">
						<h6> Rendering </h6>
						<div> FoV </div> <input attr="4" oninput="settingsset()" type="number">
						<div> Render Dis </div> <input attr="5" oninput="settingsset()" type="number">
						<div> BG Color </div> <input attr="6" oninput="settingsset()" type="text" placeholder="00AAFF">
						<h6> Peformance </h6>
						<div> Max FPS </div> <input attr="7" oninput="settingsset()" type="number">
						<div> Fog </div> <input attr="8" oninput="settingsset()" type="checkbox">
						<div> Lighting </div> <input attr="9" oninput="settingsset()" type="checkbox">
						<div> Hi Poly Ball </div> <input attr="10" oninput="settingsset()" type="checkbox">
						<div> Debug Mesh </div> <input attr="11" oninput="settingsset()" type="checkbox">
						<h6 style="color:red"> Danger Zone </h6>
						<button id="menusettingsreset" style="background:red;color:white" onclick="settingsreset()"> Reset to Default </button>
					</div>
					<button class="menushortcut left"  onclick="page(0)"> <a disabled href=" " title="Credits"> üí≥ </a> </button>
					<button class="menushortcut right" onclick="page(-2)"> <a disabled href=" " title="Back"> ‚û°Ô∏è </a> </button>
			 	</div>
				<div id="menumain">
					<input id="menuinput" oninput="input()" type="text" placeholder="Room Code"> <br>
					<button onclick="play()" id="menubutton"> Create Room </button>
					<button class="menushortcut left"  onclick="page(-1)"> <a disabled href=" " title="Settings"> ‚öôÔ∏è </a> </button>
					<button class="menushortcut right" onclick="page(-3)"> <a disabled href=" " title="Editor"> üñåÔ∏è </a> </button>
				</div>
				<div id="menueditor">
					<iframe id="menuiframe"> </iframe>
					<button class="menushortcut left" onclick="page(-2)"> <a disabled href=" " title="Back"> ‚¨ÖÔ∏è </a> </button>
					<button class="menushortcut active right"> <a disabled href="putt/editor.html" target="_blank" title="Open in new tab"> ‚¨ÜÔ∏è </a> </button>
				</div>
			</div>
		</div>
		<script defer>
			const e_menubutton = document.getElementById("menubutton");
			const e_menuinput  = document.getElementById("menuinput");
			const e_menuiframe = document.getElementById("menuiframe");
			const e_menuitem   = document.getElementById("menuitem");
			const e_menugrid   = document.getElementById("menugrid");
			const e_menu       = document.getElementById("menu");
			const e_game       = document.getElementById("game");
			let settings = localStorage["s"];
			let settingspopulated = false;
			// settings
			function settingsset() {
				if (event.target.type === "checkbox") {
					settings[event.target.getAttribute("attr")] = event.target.checked ? 1 : 0									
				} else {
					settings[event.target.getAttribute("attr")] = event.target.value
				}
				localStorage["s"] = settings.map(i => {
					return window.encodeURIComponent(i);
				}).join(",");
			}
			function settingsdefault() {
				settings = [
					"Noob" + Math.floor(Math.random() * 9999).toString().padStart(4, "0"),
					Math.floor(Math.random() * (1 << 24)).toString(16).toUpperCase().padStart(6, "0"),
					100,
					100,
					100,
					100,
					"00AAFF",
					30,
					1,
					1,
					1,
					0
				];
			}
			function settingspopulate() {
				let count = 0;
				Object.values(e_menugrid.children).forEach(i => {
					let attr = i.getAttribute("attr");
					if (attr === null) return;
					if (i.type === "checkbox") {
						i.checked = settings[attr] && settings[attr] !== "0" ? true : false;
					} else {
						i.value = settings[attr];
					}
					++count;
				});
				if (count !== settings.length) {
					if (!confirm("Your settings seem to be invalid, press OK to reset them")) return;
					settingsdefault();
					settingspopulate();
					settingssave();
				}
			}
			function settingssave() {
				localStorage["s"] = settings.map(i => {
					return window.encodeURIComponent(i);
				}).join(",");
			}
			function settingsreset() {
				if (!confirm("This will reset all settings forever (a very long time)")) return;
				settingsdefault();
				settingspopulate();
				settingssave();
			}
			// Events
			function page(p) {
				if (p === -3 && e_menuiframe.src.length === 0) {
					e_menuiframe.src = "putt/editor.html";
				} else if (p == -1 && settingspopulated === false) {
					settingspopulate();
					settingspopulated = true;
				}
				e_menuitem.style.transform = `translateX(${p}00vw)`;
			}
			function input() {
				if (event.target.value.length === 0) {
					menubutton.innerHTML = "Create Room";
				} else {
					menubutton.innerHTML = "Join Room";
				}
			}
			function play() {
				let v = "./putt/game.html";
				if (e_menuinput.value) v += `?${menuinput.value}`;
				if (event.ctrlKey) {
					const e = document.createElement("a");
					e.href = v;
					e.target = "_blank";
					e.click();
					return;
				}
				e_game.src = v;
				e_menu.style.transform = "translateY(-100vh)";
			}
			// Main
			e_menuiframe.contentDocument.body.innerHTML = "<h2 style='margin:0;position:absolute;left:0;top:11vh;width:100vw;text-align:center;color:white'>Loading Editor</h2>"
			e_game.contentDocument.body.innerHTML = "<h2 style='margin:0;position:absolute;left:0;top:11vh;width:100vw;text-align:center;color:white'>Loading Game</h2>"
			if (settings === undefined) {
				settingsdefault();
				settingssave();
			} else {
				settings = settings.split(",").map(i => {
					return window.decodeURIComponent(i);
				});
			}
			window.onkeydown = () => {
				if (event.key !== "Escape") return;
				if (e_menu.style.transform.length === 0) {
					if (e_game.src) e_menu.style.transform = "translateY(-100vh)";
				} else {
					e_menu.style.transform = "";
				}
			}
			window.onmessage = () => {
				if (!event.data.length) return;
				if (event.data[0] === "GAME") {
					console.log("hi")
					if (e_menu.style.transform.length === 0) {
						if (e_game.src) e_menu.style.transform = "translateY(-100vh)";
					} else {
						e_menu.style.transform = "";
					}
				} else if (event.data[0] === "EDITOR") {
					let d = event.data[1];
					if (e_game.src) {
						window.setTimeout(() => {
							e_game.contentWindow.postMessage(["MAIN", d]);
						}, 50);
					} else {
						let v = "./game.html";
						if (e_menuinput.value) v += `?${menuinput.value}`;
						e_game.src = v;
						window.setTimeout(() => {
							e_game.contentWindow.postMessage(["MAIN", d]);
						}, 2000);
					}
					e_menu.style.transform = "translateY(-100vh)";
				}
			}
		</script>
	</body>
</html
